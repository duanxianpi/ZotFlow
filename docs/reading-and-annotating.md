# Reading & Annotating

ZotFlow includes a built-in reader for PDFs, EPUBs, and HTML snapshots — powered by the same rendering engine as Zotero's own reader. You can read and annotate documents without ever leaving Obsidian.

---

## Opening an Attachment

### From the Tree View

1. Open the **Zotero Tree View** (command palette → `ZotFlow: Open Zotero Tree View`).
2. Expand a library → collection → item.
3. **Double-click** an attachment (PDF, EPUB, or HTML) to open it in the reader.

If you double-click an attachment that's already open in another tab, ZotFlow activates the existing tab instead of opening a duplicate.

### From a Source Note

Source notes generated by ZotFlow include deep links to attachments. Click any attachment link to open it:

```markdown
- [paper.pdf](obsidian://zotflow?type=open-attachment&libraryID=1&key=ABC12345)
```

### From Annotation Callouts

Each annotation callout in a source note links directly to its location in the PDF. Click the callout header to jump to that annotation in the reader:

```markdown
> [!zotflow-highlight-#ffd400] [paper.pdf, p.5](obsidian://zotflow?type=open-attachment&libraryID=1&key=ABC12345&navigation=...)
```

### Via Protocol URI

You can open any attachment programmatically using:

```
obsidian://zotflow?type=open-attachment&libraryID=<id>&key=<key>
```

Add `&navigation=<json>` to jump to a specific page or annotation.

---

## Annotation Types

The reader supports several annotation types:

| Type          | Description                                                  |
| ------------- | ------------------------------------------------------------ |
| **Highlight** | Select text and apply a colored highlight.                   |
| **Note**      | Place a sticky note on a specific location on the page.      |
| **Image**     | Draw a rectangular selection to capture an area as an image. |
| **Ink**       | Freehand drawing on the page.                                |

Each annotation can have:

- A **color** (from the reader's color palette)
- An optional **comment** (your thoughts about the highlighted passage)
- **Tags** (carried over from Zotero)

---

## Zotero Cloud vs. Local Reader

ZotFlow has **two reader modes**:

### Zotero Reader (Cloud Items)

- Opens attachments synced from your Zotero library.
- Annotations sync back to Zotero on the next bidirectional sync.
- Accessed by double-clicking attachments in the Tree View or clicking links in source notes.

### Local Reader (Vault Files)

- Opens PDF/EPUB/HTML files that live directly in your vault (not from Zotero).
- Annotations are stored in a local source note (not sent to Zotero).
- Enable in **Settings → ZotFlow → General → Overwrite PDF/EPUB/HTML Viewer** to replace Obsidian's default file viewer.
- After enabling, any PDF/EPUB/HTML file in your vault opens in the ZotFlow reader automatically. **Requires an Obsidian restart.**

---

## Annotation Images

For **image** and **ink** annotations, ZotFlow can automatically extract the visual content and save it as a PNG file in your vault.

### Setup

1. Go to **Settings → ZotFlow → General**.
2. Enable **Auto Import Annotation Images**.
3. Set an **Annotation Image Folder** (e.g., `Attachments/ZotFlow`).

### How It Works

- When a source note is created or updated, image/ink annotations are extracted from the PDF and saved as `<annotation-key>.png` in the configured folder.
- The source note embeds them with:

```markdown
> > ![[Attachments/ZotFlow/ANNOTATION_KEY.png]]
```

- You can also trigger extraction manually via the Tree View: right-click an item → **Extract annotation images**.

---

## Live Annotation Refresh

When a sync completes while you have a document open in the reader, annotations are **automatically refreshed** — you'll see new or updated annotations from Zotero appear without reopening the document.

---

## Drag & Drop from Tree View

You can **drag** items and attachments from the Tree View into any note:

| Dragged Item     | Inserted Content                                                           |
| ---------------- | -------------------------------------------------------------------------- |
| **Attachment**   | A markdown link: `[filename](obsidian://zotflow?type=open-attachment&...)` |
| **Regular item** | A wikilink to the source note: `[[Source/ZotFlow/Item Title]]`             |

Dragging a regular item also triggers an update of its source note to ensure it exists and is current.

---

## What's Next?

- **[Source Notes](source-notes.md)** — Learn how generated notes work and how to customize them.
- **[Template Guide](template-guide.md)** — Full variable and filter reference for customizing note output.
